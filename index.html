<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Client Management System</title>
<style>
  body {
    font-family: 'Poppins', sans-serif;
    background: #f9f9f9;
    color: #222;
    margin: 0;
    padding: 20px;
  }

  h1 {
    text-align: center;
    color: #333;
  }

  .container {
    max-width: 900px;
    margin: 0 auto;
    background: white;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  }

  .controls {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    margin-bottom: 10px;
  }

  select, button {
    margin: 5px 0;
    padding: 8px 12px;
    border-radius: 6px;
    border: 1px solid #ccc;
    font-size: 15px;
  }

  table {
    width: 100%;
    border-collapse: collapse;
  }

  th, td {
    padding: 10px 8px;
    border-bottom: 1px solid #ddd;
    text-align: left;
    font-size: 14px;
    word-break: break-word;
  }

  th {
    background: #f3f3f3;
  }

  @media (max-width: 600px) {
    table, thead, tbody, th, td, tr {
      display: block;
    }
    tr {
      margin-bottom: 15px;
      background: #fff;
      border-radius: 10px;
      padding: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    }
    td {
      display: flex;
      justify-content: space-between;
      border: none;
      padding: 6px 0;
    }
    td::before {
      content: attr(data-label);
      font-weight: bold;
      color: #555;
    }
  }

  .btn-wa {
    background: #25D366;
    color: white;
    border: none;
    border-radius: 5px;
    padding: 6px 10px;
    cursor: pointer;
  }

  .btn-primary {
    background: #007bff;
    color: white;
    border: none;
    border-radius: 5px;
    padding: 6px 10px;
    cursor: pointer;
  }

  .reminder-section {
    margin-top: 30px;
    background: #fff;
    padding: 15px;
    border-radius: 10px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  }

</style>
</head>
<body>

<div class="container">
  <h1>Client Management System</h1>

  <div class="controls">
    <select id="filterType" onchange="filterClients()">
      <option value="all">All Clients</option>
      <option value="GST">GST Clients</option>
      <option value="ITR">ITR Clients</option>
    </select>
    <button onclick="fetchData()">🔄 Refresh</button>
  </div>

  <table id="clientTable">
    <thead>
      <tr>
        <th>Name</th>
        <th>Client Type</th>
        <th>Mobile</th>
        <th>Email</th>
        <th>Aadhar</th>
        <th>PAN</th>
        <th>GST No</th>
        <th>Portal ID</th>
        <th>Password</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div class="reminder-section">
    <h2>📅 Reminders (This Week)</h2>
    <div id="reminderList">Loading...</div>
  </div>
</div>

<script>
const sheetURL = "https://script.google.com/macros/s/AKfycbzKuD852vBtPRkyH28D3IjXrvRwSIJNPj2a5262uNSQdHoxkrJp4JsgjWbOQ9TDNxkmPg/exec";
let allClients = [];

async function fetchData(){
  const res = await fetch(sheetURL);
  const data = await res.json();
  allClients = data;
  renderTable(data);
  renderReminders(data);
}

function renderTable(clients){
  const tbody = document.querySelector('#clientTable tbody');
  tbody.innerHTML = '';
  clients.forEach(c => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td data-label="Name">${c.name}</td>
      <td data-label="Type">${c.type}</td>
      <td data-label="Mobile">${c.mobile}</td>
      <td data-label="Email">${c.email}</td>
      <td data-label="Aadhar">${c.aadhar}</td>
      <td data-label="PAN">${c.pan}</td>
      <td data-label="GST">${c.gst}</td>
      <td data-label="User ID">${c.portalId}</td>
      <td data-label="Password">${c.portalPass}</td>
    `;
    tbody.appendChild(tr);
  });
}

function filterClients(){
  const type = document.getElementById('filterType').value;
  if(type === "all") renderTable(allClients);
  else renderTable(allClients.filter(c => c.type.toLowerCase() === type.toLowerCase()));
}

// 🗓️ Reminders logic
function renderReminders(rem){
  const rdiv = document.getElementById('reminderList');
  rdiv.innerHTML = '';

  const today = new Date();
  const weekStart = new Date(today);
  weekStart.setDate(today.getDate() - 3);
  const weekEnd = new Date(today);
  weekEnd.setDate(today.getDate() + 7);

  const reminders = [];

  rem.forEach(c => {
    // GST reminder every 11th and 20th
    if(c.type === "GST"){
      const d11 = new Date(today.getFullYear(), today.getMonth(), 11);
      const d20 = new Date(today.getFullYear(), today.getMonth(), 20);
      [d11, d20].forEach(d => {
        if(d >= weekStart && d <= weekEnd){
          reminders.push({name:c.name, date:d.toDateString(), type:"GST Return Due"});
        }
      });
    }

    // ITR reminder on 30th August
    if(c.type === "ITR"){
      const d30 = new Date(today.getFullYear(), 7, 30);
      if(d30 >= weekStart && d30 <= weekEnd){
        reminders.push({name:c.name, date:d30.toDateString(), type:"ITR Filing Due"});
      }
    }

    // Birthday reminder (based on DOB)
    if(c.dob){
      const dob = new Date(c.dob);
      const bd = new Date(today.getFullYear(), dob.getMonth(), dob.getDate());
      if(bd >= weekStart && bd <= weekEnd){
        reminders.push({name:c.name, date:bd.toDateString(), type:"🎂 Birthday"});
      }
    }
  });

  if(reminders.length === 0){
    rdiv.innerHTML = '<p>No reminders this week 🎉</p>';
    return;
  }

  reminders.forEach(r => {
    const div = document.createElement('div');
    div.innerHTML = `<b>${r.name}</b> — ${r.type} (${r.date})<hr>`;
    rdiv.appendChild(div);
  });
}

fetchData();
</script>

</body>
</html>