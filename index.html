<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Client Management System</title>
<style>
  body{font-family:Inter,Segoe UI,Arial,sans-serif;background:#f6f8fb;margin:0;padding:0}
  header{background:#263445;color:#fff;padding:14px;text-align:center;font-size:18px}
  main{max-width:1000px;margin:20px auto;padding:0 16px}
  h2{color:#263445;margin:10px 0}
  .panel{background:#fff;padding:14px;border-radius:8px;box-shadow:0 6px 18px rgba(0,0,0,0.06);margin-bottom:18px}
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:10px}
  input,select{width:100%;padding:8px;border:1px solid #ddd;border-radius:6px;box-sizing:border-box}
  button{padding:8px 12px;border-radius:6px;border:none;cursor:pointer}
  .btn-primary{background:#2f80ed;color:#fff}
  .btn-success{background:#27ae60;color:#fff}
  .btn-wa{background:#25D366;color:#fff}
  table{width:100%;border-collapse:collapse;margin-top:10px}
  th,td{padding:10px;border-bottom:1px solid #eee;text-align:left;font-size:14px}
  th{background:#1b2b3a;color:#fff;position:sticky;top:0}
  .tick{cursor:pointer;font-weight:700;color:#2ecc71}
  .small{font-size:13px;color:#555}
</style>
</head>
<body>
<header>üìÅ Client Management System</header>
<main>
  <div class="panel">
    <h2>Clients</h2>
    <button class="btn-primary" onclick="toggleForm()">‚ûï Add New Client</button>

    <form id="addClientForm" style="display:none;margin-top:12px" onsubmit="return addClient(event)">
      <div class="grid">
        <input id="name" placeholder="Name" required>
        <input id="mobile" placeholder="Mobile (digits only)" required>
        <input id="email" type="email" placeholder="Email">
        <input id="dob" type="date" placeholder="DOB">
        <input id="aadhar" placeholder="Aadhaar (optional)">
        <input id="pan" placeholder="PAN">
        <input id="gst" placeholder="GST">
        <input id="portalId" placeholder="Portal ID">
        <input id="portalPassword" placeholder="Portal Password">
        <select id="service"><option>GST</option><option>ITR</option></select>
        <select id="status"><option>Pending</option><option>Filed</option></select>
      </div>
      <div style="margin-top:10px"><button class="btn-success" type="submit">Add Client</button></div>
    </form>

    <table id="clientTable">
      <thead><tr><th>#</th><th>Name</th><th>Mobile</th><th>Email</th><th>Service</th><th>Status</th><th>Action</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>

  <div class="panel">
    <h2>Reminders</h2>
    <div id="reminderList" class="small"></div>
  </div>
</main>

<script>
  // üëâ Replace with your Apps Script Web App URL
  const sheetURL = "https://script.google.com/macros/s/AKfycbzKuD852vBtPRkyH28D3IjXrvRwSIJNPj2a5262uNSQdHoxkrJp4JsgjWbOQ9TDNxkmPg/exec";

  function toggleForm(){
    const f=document.getElementById('addClientForm');
    f.style.display=(f.style.display==='none'||f.style.display==='')?'block':'none';
  }

  async function fetchData(){
    try{
      const res=await fetch(sheetURL);
      const data=await res.json();
      renderClients(data.clients||[]);
      renderReminders(data.reminders||[]);
    }catch(err){
      console.error(err);
    }
  }

  function renderClients(clients){
    const tb=document.querySelector('#clientTable tbody');
    tb.innerHTML='';
    clients.forEach((c,i)=>{
      const row=document.createElement('tr');
      const sheetRow=c._sheetRow||c._sheetrow;
      row.innerHTML=`<td>${i+1}</td>
        <td>${c.name||''}</td>
        <td>${c.mobile||''}</td>
        <td>${c.email||''}</td>
        <td>${c.service||''}</td>
        <td>${c.status||''}</td>
        <td><span class="tick" onclick="toggleStatus(${sheetRow},this)">${(c.status||'').toLowerCase().includes('filed')?'‚úî Filed':'Mark Filed'}</span></td>`;
      tb.appendChild(row);
    });
  }

  async function addClient(e){
    e.preventDefault();
    const payload={
      name:document.getElementById('name').value,
      mobile:document.getElementById('mobile').value,
      email:document.getElementById('email').value,
      dob:document.getElementById('dob').value,
      aadhar:document.getElementById('aadhar').value,
      pan:document.getElementById('pan').value,
      gst:document.getElementById('gst').value,
      portalId:document.getElementById('portalId').value,
      portalPassword:document.getElementById('portalPassword').value,
      service:document.getElementById('service').value,
      status:document.getElementById('status').value
    };
    await fetch(sheetURL,{method:'POST',body:JSON.stringify(payload)});
    alert('Client Added');
    e.target.reset();
    toggleForm();
    fetchData();
  }

  async function toggleStatus(row,el){
    const newStatus=el.innerText.toLowerCase().includes('filed')?'Pending':'Filed';
    await fetch(sheetURL,{method:'PUT',body:JSON.stringify({row,status:newStatus})});
    fetchData();
  }

  function renderReminders(rem){
    const rdiv=document.getElementById('reminderList');
    rdiv.innerHTML='';
    rem.forEach(r=>{
      const d=document.createElement('div');
      d.innerHTML=`<b>${r.name}</b> ‚Äî ${r.type} (${r.date}) 
      <br><button class="btn-wa" onclick="wa('${r.mobile}','${r.name}','${r.message}')">WhatsApp</button>
      <button class="btn-primary" onclick="email('${r.email}','${r.name}','${r.message}')">Email</button><hr>`;
      rdiv.appendChild(d);
    });
  }

  function wa(num,name,msg){
    if(!num)return alert('No mobile');
    const m=num.length===10?'91'+num:num;
    window.open(`https://wa.me/${m}?text=${encodeURIComponent('Hello '+name+', '+msg)}`,'_blank');
  }

  function email(to,name,msg){
    if(!to)return alert('No email');
    window.open(`mailto:${to}?subject=Reminder&body=${encodeURIComponent('Dear '+name+', '+msg)}`,'_blank');
  }

  fetchData();
</script>
</body>
</html>
